\ProvidesPackage{bubble_plot}

\usepackage{tikz}
\usetikzlibrary{positioning}

\usepackage{pgfplots}
\usepackage{pgfplotstable}

\newcommand*{\outline}[1]{#1!50!black}

\newlength{\xWidth}
\newlength{\yHeight}
\newlength{\ySpacing}
\newlength{\yearXShift}
\newlength{\yearYShift}
\newlength{\xLeftXShift}
\newlength{\xRightXShift}

\pgfplotsset{
    compat=1.15,
    grid=major,
    major grid style={dashed},
    point meta=explicit,
    xtick=data,
    xticklabel style={font=\scriptsize, align=center, anchor=north east, rotate=70},
    ytick=data,
    yticklabel style={fill=white, inner sep=1.5pt, font=\scriptsize, above=0.5mm, name=yTickLabel-\ticknum},
    ylabel style={at={(ticklabel* cs:1,0)}, rotate=-90, anchor=south},
    axis y line*=middle,
    colormap name=yearcolor,
    colormap access=piecewise const,
    scatter/@pre marker code/.code={
        \pgfplotstablegetelem{\coordindex}{years}\of{\datatable}
        \pgfplotscolormapdefinemappedcolor{\pgfplotsretval}
        \pgfmathparse{\pgfplotspointmetatransformed / 1000 * 5 + 1}
        \def\markopts{
            mark=text,
            text mark=\pgfmathprintnumber{\pgfplotspointmeta},
            text mark as node=true,
            text mark style={
                circle,
                font=\tiny,
                draw=\outline{mapped color},
                fill=mapped color,
                inner sep=\pgfmathresult
            }
        }
        \expandafter\scope\expandafter[\markopts]
    },
}
